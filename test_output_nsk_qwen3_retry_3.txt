  Determining projects to restore...
  All projects are up-to-date for restore.
  AiTextEditor.Lib -> C:\Private\AITextEditor\src\AiTextEditor.Lib\bin\Debug\net9.0\AiTextEditor.Lib.dll
  AiTextEditor.SemanticKernel -> C:\Private\AITextEditor\src\AiTextEditor.SemanticKernel\bin\Debug\net9.0\AiTextEditor.SemanticKernel.dll
  AiTextEditor.Domain.Tests -> C:\Private\AITextEditor\tests\AiTextEditor.Domain.Tests\bin\Debug\net9.0\AiTextEditor.Domain.Tests.dll
Test run for C:\Private\AITextEditor\tests\AiTextEditor.Domain.Tests\bin\Debug\net9.0\AiTextEditor.Domain.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 18.0.1 (x64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
C:\Private\AITextEditor\tests\AiTextEditor.Domain.Tests\bin\Debug\net9.0\AiTextEditor.Domain.Tests.dll
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v3.1.4+50e68bbb8b (64-bit .NET 9.0.11)
[xUnit.net 00:00:00.29]   Discovering: AiTextEditor.Domain.Tests
[xUnit.net 00:00:00.47]   Discovered:  AiTextEditor.Domain.Tests
[xUnit.net 00:00:00.55]   Starting:    AiTextEditor.Domain.Tests
  Passed AiTextEditor.Domain.Tests.CursorAgentResponseParserTests.ParseFinalizer_ReturnsNullForInvalidJson [37 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentResponseParserTests.ParseCommand_HandlesSanitizedPayload [109 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentResponseParserTests.ParseFinalizer_ReadsSuccessPayload [1 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "blockquote-and-code.md") [205 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "nested-sections.md") [3 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "mixed-lists.md") [13 ms]
  Passed AiTextEditor.Domain.Tests.CursorStreamTests.CursorReadsAllItemsFromNeznaykaSample(fileName: "neznayka_sample.md") [222 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "chapter-with-list.md") [4 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownLinearizationTests.BuildLinearDocument_AssignsPointersWithOffsets [233 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownLinearizationTests.ListItems_TrackLineOffsets [1 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "neznayka_sample.md") [9 ms]
info: AiTextEditor.SemanticKernel.SemanticKernelEngine[0]
      Kernel built with model qwen3-next:80b-cloud at http://localhost:11434/v1
info: AiTextEditor.SemanticKernel.SemanticKernelEngine[0]
      User command: Tell me how the second chapter ends. Answer in English.
  Passed AiTextEditor.Domain.Tests.McpServerTests.TargetSetLifecycle_AllowsQueryingAndDeletion [236 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.GetItems_ThrowsWhenDocumentMissing [1 ms]
  Passed AiTextEditor.Domain.Tests.MarkdownRoundtripTests.ReadThenWrite_DoesNotAlterMarkdown(fileName: "thematic-breaks.md") [6 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentPromptBuilderTests.BuildBatchMessage_ReflectsPortion [310 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentPromptBuilderTests.BuildEvidenceSnapshot_TrimsToLimit [20 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentPromptBuilderTests.BuildTaskDefinitionPrompt_SkipsEmptyContext [25 ms]
  Passed AiTextEditor.Domain.Tests.CursorAgentPromptBuilderTests.CreateSettings_UsesLimits [12 ms]
info: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Prompt tokens: 1017. Completion tokens: 6221. Total tokens: 7238.
dbug: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Function calls: cursor-create_cursor [Id: call_ba997c8015e24323897ed1e2]
dbug: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Auto function invocation filter context: Name:cursor-create_cursor, Id:call_ba997c8015e24323897ed1e2, IsStreaming:False FunctionSequenceIndex:0, RequestSequenceIndex:0, FunctionCount:1
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      auto_invoke: callId=call_ba997c8015e24323897ed1e2, plugin=cursor, function=create_cursor, requestIndex=0, functionIndex=0, args={"filterDescription":"text contains 'Chapter 2'","name":"search_cursor"}
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function cursor-create_cursor invoking.
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      function_invoke: plugin=cursor, function=create_cursor, streaming=False, args={"filterDescription":"text contains 'Chapter 2'","name":"search_cursor"}
info: AiTextEditor.SemanticKernel.CursorPlugin[0]
      CreateCursor: name=search_cursor, startAfter=, maxElements=3, maxBytes=4096, filterDescription=text contains 'Chapter 2'
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      function_result: plugin=cursor, function=create_cursor, durationMs=0.88, result={"value":"search_cursor","valueType":"System.String"}
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function cursor-create_cursor succeeded.
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function cursor-create_cursor completed. Duration: 0.0048133s
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      auto_result: callId=call_ba997c8015e24323897ed1e2, plugin=cursor, function=create_cursor, durationMs=14.92, result={"value":"search_cursor","valueType":"System.String"}
info: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Prompt tokens: 1066. Completion tokens: 2484. Total tokens: 3550.
dbug: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Function calls: agent-run_agent [Id: call_135b11b6b5c54a0090caee2c]
dbug: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Auto function invocation filter context: Name:agent-run_agent, Id:call_135b11b6b5c54a0090caee2c, IsStreaming:False FunctionSequenceIndex:0, RequestSequenceIndex:1, FunctionCount:1
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      auto_invoke: callId=call_135b11b6b5c54a0090caee2c, plugin=agent, function=run_agent, requestIndex=1, functionIndex=0, args={"cursorName":"search_cursor","taskDescription":"find the end of Chapter 2 by identifying the last paragraph before the next chapter starts"}
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function agent-run_agent invoking.
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      function_invoke: plugin=agent, function=run_agent, streaming=False, args={"cursorName":"search_cursor","taskDescription":"find the end of Chapter 2 by identifying the last paragraph before the next chapter starts"}
info: AiTextEditor.SemanticKernel.CursorPlugin[0]
      CursorStream.NextPortion: currentIndex=0, isComplete=False
info: AiTextEditor.SemanticKernel.CursorPlugin[0]
      CursorStream.NextPortion: advancing from 0 to 3. Items count: 3
info: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Prompt tokens: 657. Completion tokens: 1863. Total tokens: 2520.
info: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_call: step=0, model=qwen3-next:80b-cloud, tokens=<unknown>, result=<received>
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw: step=0, snippet=
{
  "decision": "continue",
  "newEvidence": []
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_len: step=0, len=51
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_head: step=0, head=
{
  "decision": "continue",
  "newEvidence": []
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_tail: step=0, tail=
{
  "decision": "continue",
  "newEvidence": []
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_parsed: step=0, decision=continue, finishFound=False, parsedAction={
  "decision": "continue",
  "newEvidence": []
}
info: AiTextEditor.SemanticKernel.AgentPlugin[0]
      RunAgent: Auto-advancing cursor 'search_cursor' (step 1)...
info: AiTextEditor.SemanticKernel.CursorPlugin[0]
      CursorStream.NextPortion: currentIndex=3, isComplete=False
info: AiTextEditor.SemanticKernel.CursorPlugin[0]
      CursorStream.NextPortion: advancing from 3 to 5. Items count: 2
info: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Prompt tokens: 651. Completion tokens: 1817. Total tokens: 2468.
info: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_call: step=1, model=qwen3-next:80b-cloud, tokens=<unknown>, result=<received>
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw: step=1, snippet=
{
  "decision": "done",
  "newEvidence": [
    {
      "pointer": "5:2.p2",
      "excerpt": "The second chapter ends with a cliffhanger about the hidden door.",
      "reason": "Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2."
    }
  ]
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_len: step=1, len=280
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_head: step=1, head=
{
  "decision": "done",
  "newEvidence": [
    {
      "pointer": "5:2.p2",
      "excerpt": "The second chapter ends with a cliffhanger about the hidden door.",
      "reason": "Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2."
    }
  ]
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_raw_tail: step=1, tail=
{
  "decision": "done",
  "newEvidence": [
    {
      "pointer": "5:2.p2",
      "excerpt": "The second chapter ends with a cliffhanger about the hidden door.",
      "reason": "Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2."
    }
  ]
}
dbug: AiTextEditor.SemanticKernel.CursorAgentRuntime[0]
      cursor_agent_parsed: step=1, decision=done, finishFound=True, parsedAction={
  "decision": "done",
  "newEvidence": [
    {
      "pointer": "5:2.p2",
      "excerpt": "The second chapter ends with a cliffhanger about the hidden door.",
      "reason": "Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2."
    }
  ]
}
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      function_result: plugin=agent, function=run_agent, durationMs=30307.46, result={"value":"Decision: done\r\nEvidence:\r\n- Pointer: 5:2.p2\r\n  Excerpt: The second chapter ends with a cliffhanger about the hidden door.\r\n  Reason: Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2.\r\n\r\nStatus: Cursor complete (no more items).\r\n","valueType":"System.String"}
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function agent-run_agent succeeded.
info: Microsoft.SemanticKernel.KernelFunction[0]
      Function agent-run_agent completed. Duration: 30.311309s
info: AiTextEditor.SemanticKernel.FunctionInvocationLoggingFilter[0]
      auto_result: callId=call_135b11b6b5c54a0090caee2c, plugin=agent, function=run_agent, durationMs=30314.34, result={"value":"Decision: done\r\nEvidence:\r\n- Pointer: 5:2.p2\r\n  Excerpt: The second chapter ends with a cliffhanger about the hidden door.\r\n  Reason: Mentions 'second chapter ends', indicating it's the concluding paragraph of Chapter 2.\r\n\r\nStatus: Cursor complete (no more items).\r\n","valueType":"System.String"}
info: Microsoft.SemanticKernel.Connectors.OpenAI.OpenAIChatCompletionService[0]
      Prompt tokens: 1189. Completion tokens: 288. Total tokens: 1477.
info: AiTextEditor.SemanticKernel.SemanticKernelEngine[0]
      LLM answer: 
The second chapter ends with a cliffhanger about the hidden door.
  Passed AiTextEditor.Domain.Tests.McpServerTests.ChapterSummaryScenario_UsesNavigationAndSummarization [1 m 29 s]
  Passed AiTextEditor.Domain.Tests.McpServerTests.ApplyOperations_ThrowsForUnknownTargetPointer [6 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.GetItems_ReturnsLinearItems [1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.CreateTargetSet_UsesLinearDocumentItems [< 1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.ApplyOperations_ReindexesAndUpdatesSource [2 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.DeleteTargetSet_ReturnsFalseForUnknownId [< 1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.LoadDefaultDocument_EnablesParameterlessOperations [1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.GetDocument_ReturnsNullForUnknownId [< 1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.CreateTargetSet_FiltersDuplicatesAndOutOfRange [< 1 ms]
  Passed AiTextEditor.Domain.Tests.McpServerTests.LoadDocument_AllowsExplicitId [< 1 ms]
MSBUILD : error MSB4166: Child node "2" exited prematurely. Shutting down. Diagnostic information may be found in files in "C:\Users\Dorog\AppData\Local\Temp\MSBuildTemp\" and will be named MSBuild_*.failure.txt. This location can be changed by setting the MSBUILDDEBUGPATH environment variable to a different directory.
^C